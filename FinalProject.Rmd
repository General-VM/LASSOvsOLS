---
title: "LASSO vs OLS"
author: "Victor Matyiku, Rebecca Ly"
date: "2025-03-06"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# P = 10

## Generating Data

```{r}
generate_data <- function(p, n){
  beta0 <- rnorm(1)
  #beta <- matrix(rnorm(p), nrow = p, ncol = 1)
  beta <- c(1, 2, 3, 0, 5, 6, 0, 8, 0, 0) 
  
  predictors <- matrix(
    rnorm(n*p), nrow = n, ncol = p,
    dimnames = list(rows = 1:n, cols = paste("X", 1:p, sep=""))
  )
  
  errors <- rnorm(n)
  observations <- data.frame(Y = beta0 + predictors %*% beta + errors)
  
  output <- as.data.frame(
    cbind(observations, predictors)
  )
  
  return(output)
}

generated_data <- generate_data(10, 100)
head(generated_data)
```

## OLS

```{r}
get_ols_sig_coefs <- function(input_data){
  ols_model <- lm(Y ~ ., input_data)
  significant_coefs <- data.frame(Coefficients = summary(ols_model)$coef[summary(ols_model)$coef[,4] <= .05, 4])
  
  return(significant_coefs)
}

significant_coefs <- get_ols_sig_coefs(generated_data)
significant_coefs
```

```{r}
ols_sq_error <- function(significant_coefs, input_data) {
  ols_coefs <- t(significant_coefs)
  significant_predictors <- colnames(ols_coefs)[colnames(ols_coefs) != "(Intercept)"]
  ols_beta_0 <- ols_coefs[, "(Intercept)"]
  ols_coefs <- ols_coefs[, significant_predictors]
  
  sig_predictors_matrix <- as.matrix(input_data[, significant_predictors])
  res <- data.frame(Residuals = input_data$Y - ols_beta_0 - sig_predictors_matrix %*% ols_coefs)
  sq_error <- (norm(as.matrix(res, ncol=1), "e"))^2
  return(sq_error)
}

ols_sq_error(significant_coefs, generated_data)
```

```{r}
get_q <- function(significant_coefs) {
  significant_predictors <- rownames(significant_coefs)[rownames(significant_coefs) != "(Intercept)"]
  return(length(significant_predictors))
}

q <- get_q(significant_coefs)
q
```

## LASSO

```{r}
library(glmnet)
q_prime_lasso <- matrix(0, 100, 1) #list of q' for lasso

#generating data
X <- predictors
Y <- as.matrix(observations, nrow = n)

# LASSO with CV
cv.fit <- cv.glmnet(X, Y, nfolds=10, family="gaussian") 

# optimal lambda
selected_lambda <- cv.fit$lambda.min 

# coefficients for LASSO model using selected_lambda
lasso_coefs = coef(cv.fit, s="lambda.min") 

#predict new coefficients using LASSO & selected_lambda
prediction <- predict(cv.fit, type="coefficients", s=selected_lambda)  

squared_error <- sum((lasso_coefs-prediction)^2)

# finding number of predictors chosen by LASSO
q_prime <- length(which(prediction!=0))

q_prime_lasso[i] <- q_prime

summary(q_prime_lasso)
```