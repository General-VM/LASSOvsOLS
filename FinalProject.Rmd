---
title: "LASSO vs OLS"
author: "Victor Matyiku, Rebecca Ly"
date: "2025-03-06"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# P = 10

## Generating Data

```{r}
generate_data <- function(p, n){
  beta0 <- rnorm(1)
  #beta <- matrix(rnorm(p), nrow = p, ncol = 1)
  beta <- c(1, 2, 3, 0, 5, 6, 0, 8, 0, 0) 
  
  predictors <- matrix(
    rnorm(n*p), nrow = n, ncol = p,
    dimnames = list(rows = 1:n, cols = paste("X", 1:p, sep=""))
  )
  
  errors <- rnorm(n)
  observations <- data.frame(Y = beta0 + predictors %*% beta + errors)
  
  output <- as.data.frame(
    cbind(observations, predictors)
  )
  
  return(output)
}

generated_data <- generate_data(10, 100)
head(generated_data)
```

## OLS

```{r}
ols <- function(input_data){
  ols_model <- lm(Y ~ ., input_data)
  significant_coefs <- data.frame(Coefficients = summary(ols_model)$coef[summary(ols_model)$coef[,4] <= .05, 4])
  
  ols_coefs <- t(significant_coefs)
  significant_predictors <- colnames(ols_coefs)[colnames(ols_coefs) != "(Intercept)"]
  ols_beta_0 <- ols_coefs[, "(Intercept)"]
  ols_coefs <- ols_coefs[, significant_predictors]
  
  sig_predictors_matrix <- as.matrix(input_data[, significant_predictors])
  res <- data.frame(Residuals = input_data$Y - ols_beta_0 - sig_predictors_matrix %*% ols_coefs)
  
  output <- list(sq_error = (norm(as.matrix(res, ncol=1), "e"))^2,
                 q = length(significant_predictors))
  
  return(output)
}

ols(generated_data)
```

## LASSO

```{r}
library(glmnet)
lasso <- function(input_data, n){
  X <- as.matrix(input_data[colnames(input_data) != "Y"], nrow = n)
  Y <- as.matrix(input_data$Y, nrow = n)
  
  # LASSO with CV
  cv.fit <- cv.glmnet(X, Y, nfolds=10, family="gaussian") 
  
  # optimal lambda
  selected_lambda <- cv.fit$lambda.min 
  
  # coefficients for LASSO model using selected_lambda
  lasso_coefs = coef(cv.fit, s="lambda.min") 
  
  #predict new coefficients using LASSO & selected_lambda
  prediction <- predict(cv.fit, type="coefficients", s=selected_lambda)  
  
  
  output <- list(sq_error = sum((lasso_coefs-prediction)^2),
                 q_prime = length(which(prediction!=0)))
  
  return(output)
}

lasso(generated_data, 100)
```